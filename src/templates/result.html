<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <title>K·∫øt qu·∫£ ki·ªÉm tra - Plagiarism Checker</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='result.css') }}"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/css/bootstrap.min.css"
    />
  </head>
  <body>
    <!-- HEADER (C·ªê ƒê·ªäNH) -->
    <header>
      <nav
        class="navbar navbar-expand-lg navbar-dark fixed-top"
        style="background-color: #f5a97f"
      >
        <a
          class="navbar-brand d-flex align-items-center"
          href="{{ url_for('index') }}"
        >
          <img
            src="{{ url_for('static', filename='logo.png') }}"
            class="logo"
          />
          <span class="app-name">Plagiarism Checker</span>
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-toggle="collapse"
          data-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div
          class="collapse navbar-collapse justify-content-end"
          id="navbarNav"
        >
          <ul class="navbar-nav">
            <li class="nav-item active">
              <a class="nav-link" href="{{ url_for('index') }}">Trang ch·ªß</a>
            </li>
            <li class="nav-item"><a class="nav-link" href="#">H∆∞·ªõng d·∫´n</a></li>
            <li class="nav-item"><a class="nav-link" href="#">Li√™n h·ªá</a></li>
          </ul>
        </div>
      </nav>
    </header>

    <div class="header-space"></div>

    <!-- KHU V·ª∞C K·∫æT QU·∫¢ -->
    <div class="result-container">
      <div class="left-panel">
        <h2 class="panel-title">üìÑ N·ªôi dung g·ªëc</h2>
        <div id="result-box" class="paper">{{ highlighted_text | safe }}</div>
        <button id="toggle-btn" class="toggle-btn">Xem to√†n b·ªô</button>
      </div>

      <div class="right-panel">
        <div class="result-summary">
          <h1>üìä K·∫øt qu·∫£ ki·ªÉm tra</h1>
          <p>
            ƒê√£ ki·ªÉm tra <strong>{{ limit_lines }}</strong> d√≤ng ƒë·∫ßu (ho·∫∑c √≠t h∆°n
            n·∫øu PDF ng·∫Øn h∆°n).
          </p>
          <p>
            T·ªâ l·ªá nghi ƒë·∫°o vƒÉn: <strong class="percent">{{ percent }}%</strong>
          </p>
          <div class="controls">
            <a href="{{ url_for('index') }}" class="btn-back">‚Üê Quay l·∫°i</a>
          </div>
        </div>

        <div class="result-details">
          <h3>üîç Chi ti·∫øt c√°c d√≤ng ƒë√£ ki·ªÉm tra</h3>
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>D√≤ng (t√≥m t·∫Øt)</th>
                <th>Plagiarized</th>
                <th>Ngu·ªìn</th>
              </tr>
            </thead>
            <tbody>
              {% for d in details %}
              <tr>
                <td>{{ loop.index }}</td>
                <td style="max-width: 300px"><code>{{ d.line }}</code></td>
                <td>{{ "Yes" if d.plagiarized else "No" }}</td>
                <td>
                  {% if d.sources %}
                  <ul>
                    {% for s in d.sources %}
                    <li>
                      <a href="{{ s }}" target="_blank" rel="noreferrer"
                        >{{ s }}</a
                      >
                    </li>
                    {% endfor %}
                  </ul>
                  {% else %} - {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- FOOTER -->
    <footer class="main-footer">
      <p>¬© 2025 Plagiarism Checker | <b>Test Giao di·ªán</b></p>
      <div class="footer-links">
        <a href="#">Ch√≠nh s√°ch</a>
        <a href="#">ƒêi·ªÅu kho·∫£n</a>
        <a href="#">H·ªó tr·ª£</a>
      </div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Tooltip khi click v√†o highlight
        document.querySelectorAll("mark.plag").forEach((el) => {
          const sources = el.getAttribute("data-sources") || "";
          if (!sources) return;
          el.title = sources;
          el.style.cursor = "pointer";
          el.addEventListener("click", () => {
            alert("Ngu·ªìn:\n" + sources.replace(/\s*\|\s*/g, "\n"));
          });
        });

        // Toggle xem to√†n b·ªô / thu g·ªçn
        const toggleBtn = document.getElementById("toggle-btn");
        const resultBox = document.getElementById("result-box");
        toggleBtn.addEventListener("click", () => {
          resultBox.classList.toggle("expanded");
          toggleBtn.textContent = resultBox.classList.contains("expanded")
            ? "Thu g·ªçn"
            : "Xem to√†n b·ªô";
        });
      });
    </script>
  </body>
</html>
